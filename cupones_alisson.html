<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cupones para Alisson 💚</title>
<style>
  :root{
    --bg:#f3fff6;
    --card:#e6fff0;
    --accent:#2e8b57; /* verde principal */
    --accent-2:#3aa06a;
    --muted:#6b6b6b;
    --white:#ffffff;
  }
  body{
    margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:
      radial-gradient(circle at 10% 10%, rgba(58,160,106,0.06), transparent 6%),
      radial-gradient(circle at 90% 90%, rgba(46,139,87,0.04), transparent 6%),
      var(--bg);
    color:#0b2b20;
    -webkit-font-smoothing:antialiased;
    padding:20px;
  }

  header{
    text-align:center;margin-bottom:18px;
  }
  .title{
    display:inline-block;padding:18px 26px;border-radius:18px;
    background:linear-gradient(135deg, rgba(58,160,106,0.12), rgba(46,139,87,0.06));
    box-shadow: 0 6px 18px rgba(45,110,85,0.08);
  }
  .title h1{
    margin:0;font-size:20px;letter-spacing:0.2px;
    color:var(--accent);
  }
  .subtitle{margin-top:6px;color:var(--muted);font-size:13px}

  main{max-width:820px;margin:0 auto;}
  .controls{display:flex;gap:10px;justify-content:center;margin-bottom:14px;flex-wrap:wrap}
  .btn{
    background:var(--accent);color:var(--white);border:none;padding:10px 14px;border-radius:10px;
    cursor:pointer;font-weight:600;box-shadow:0 6px 14px rgba(46,139,87,0.12);
  }
  .btn.alt{background:transparent;color:var(--accent);border:2px solid rgba(46,139,87,0.12)}
  .btn.print{background:var(--accent-2)}

  /* list */
  .list{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
  .card{
    background:var(--card);border-radius:14px;padding:14px;position:relative;
    box-shadow: 0 10px 20px rgba(22,60,45,0.03);
    border:1px solid rgba(20,80,60,0.03);
    transition:transform .18s ease, box-shadow .18s ease;
  }
  .card:hover{transform:translateY(-4px);box-shadow:0 16px 30px rgba(22,60,45,0.06)}
  .card h3{margin:0;font-size:16px;color:#0f3d2d}
  .card p{margin:6px 0 10px;color:var(--muted);font-size:13px}
  .emoji{font-size:20px;margin-right:8px}
  .qr{
    width:86px;height:86px;border-radius:8px;overflow:hidden;margin-left:auto;border:6px solid rgba(255,255,255,0.85);
    background:var(--white);display:flex;align-items:center;justify-content:center;
  }
  .card-footer{display:flex;align-items:center;gap:10px;margin-top:10px}
  .use-btn{
    background:linear-gradient(180deg,var(--accent),var(--accent-2));color:white;border:none;padding:10px 12px;border-radius:10px;
    cursor:pointer;font-weight:700;box-shadow:0 8px 18px rgba(46,139,87,0.14);flex:1;
  }
  .used{
    background:linear-gradient(180deg,#cfeee0,#e8fff4);color:var(--accent);border:2px solid #d6f1e6;font-weight:700;
  }
  .heart{
    font-size:18px;margin-left:6px;color:#60bf8f;transition:transform .25s ease;
  }
  .card-meta{display:flex;align-items:center;gap:10px}

  /* highlight when opened via QR fragment */
  .highlight{outline:3px solid rgba(58,160,106,0.12);box-shadow:0 10px 30px rgba(46,139,87,0.06)}

  /* small screens adjustments */
  @media (max-width:420px){
    .qr{width:70px;height:70px}
  }

  /* print styles for PDF coupons for Alisson */
  @media print{
    body{background:white;color:black}
    header, .controls{display:none}
    .list{grid-template-columns:repeat(1,1fr);gap:8px}
    .card{page-break-inside:avoid; border:none; box-shadow:none; border-radius:6px;padding:12px}
    .qr{width:150px;height:150px;border-radius:6px;border:0}
    .use-btn{display:none}
  }

  /* small helper */
  .muted{color:var(--muted);font-size:12px}
</style>
</head>
<body>
  <header>
    <div class="title">
      <h1>Cupones para <strong>Alisson</strong> 💚</h1>
      <div class="subtitle">Un regalo especial — ¡Feliz cumpleaños! 🎉</div>
    </div>
  </header>

  <main>
    <div class="controls">
      <button class="btn" id="resetBtn" title="Borrar todos los usados">Restablecer estados</button>
      <button class="btn alt" id="exportBtn" title="Exportar estados (JSON)">Exportar registro</button>
      <button class="btn alt" id="importBtn" title="Importar registro desde JSON">Importar registro</button>
      <button class="btn print" id="printBtn" title="Imprimir o guardar como PDF">Imprimir PDF para Alisson</button>
    </div>

    <section class="list" id="couponList">
      <!-- Tarjetas generadas por JS -->
    </section>

    <div style="margin-top:18px;text-align:center;color:var(--muted);font-size:13px">
      <div>Nota: Los estados se guardan sólo en este teléfono (LocalStorage). Si quieres que se sincronicen entre dispositivos, puedo ayudarte a conectar esto a Firebase/Supabase.</div>
    </div>
  </main>

<script>
/* ======= Datos de los cupones ======= */
const cupones = [
  {id:'c1', emoji:'🎬', title:'Salida al cine', text:'Vale por una salida al cine para ver lo que tú elijas.'},
  {id:'c2', emoji:'🍽️', title:'Cena en tu lugar favorito', text:'Te invito a cenar en tu restaurante favorito.'},
  {id:'c3', emoji:'🌮', title:'Noche de taquitos', text:'Tarde-noche de taquitos y risas.'},
  {id:'c4', emoji:'🎤', title:'Que te cante alguna canción', text:'Te dedicaré una canción en vivo (aunque desafine 😅).'},
  {id:'c5', emoji:'💃', title:'Cita para ir al Love', text:'Una cita especial para ir al Love y pasarla increíble.'},
  {id:'c6', emoji:'🛍️', title:'Comprarte una prenda', text:'Te compraré una prenda que te guste.'},
  {id:'c7', emoji:'🗣️', title:'Salida para platicar', text:'Una salida tranquila para platicar y ponernos al día.'},
  {id:'c8', emoji:'⏱️', title:'Vernos un ratito', text:'Un ratito para vernos y abrazarnos.'},
  {id:'c9', emoji:'🍕', title:'Comer pizza', text:'Noche de pizza con tus ingredientes favoritos.'},
  {id:'c10', emoji:'🥞', title:'Desayuno juntos', text:'Un desayuno especial juntos para empezar el día.'}
];

/* ======= Storage keys ======= */
const STORAGE_KEY = 'cupones_alisson_estado_v1';

/* ======= Helpers ======= */
function saveState(state){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}
function loadState(){
  try{
    const s = localStorage.getItem(STORAGE_KEY);
    return s ? JSON.parse(s) : {};
  }catch(e){return {}}
}
function updateCardVisual(cardEl, used){
  const btn = cardEl.querySelector('.use-btn');
  const heart = cardEl.querySelector('.heart');
  if(used){
    btn.textContent = '✅ Usado';
    btn.classList.add('used');
    heart.style.transform = 'scale(1.06)';
    heart.textContent = '💚';
  } else {
    btn.textContent = 'Usar cupón';
    btn.classList.remove('used');
    heart.style.transform = 'scale(1)';
    heart.textContent = '💚';
  }
}

/* ======= Renderizar lista ======= */
const list = document.getElementById('couponList');
let state = loadState();

function getPageBaseURL(){
  return window.location.origin + window.location.pathname;
}

function makeQRUrlForCoupon(couponId){
  // QR points to same page plus fragment #couponId
  const base = getPageBaseURL();
  return base + (base.includes('?') ? '&' : '') + '' + '#'+couponId;
}

function render(){
  list.innerHTML = '';
  cupones.forEach(c=>{
    const used = !!state[c.id];
    const card = document.createElement('article');
    card.className = 'card';
    card.id = c.id;
    card.innerHTML = `
      <div style="display:flex;gap:12px;align-items:flex-start">
        <div style="flex:1">
          <h3><span class="emoji">${c.emoji}</span>${c.title}</h3>
          <p>${c.text}</p>
          <div class="card-footer">
            <div style="flex:1" class="card-meta">
              <button class="use-btn">${used ? '✅ Usado' : 'Usar cupón'}</button>
              <span class="muted" style="margin-left:8px">Toque para marcar como usado</span>
            </div>
            <div class="qr">
              <img alt="QR" class="qr-img" src="" style="width:86px;height:86px;display:block"/>
            </div>
          </div>
        </div>
      </div>
    `;
    list.appendChild(card);

    const btn = card.querySelector('.use-btn');
    const qrImg = card.querySelector('.qr-img');

    // actualizar estado visual
    const heart = document.createElement('span'); heart.className='heart'; heart.textContent='💚';
    card.querySelector('.card-meta').appendChild(heart);
    updateCardVisual(card, used);

    // Generar URL de QR (usando Google Chart API, funciona como imagen)
    const qrUrl = 'https://chart.googleapis.com/chart?cht=qr&chs=220x220&chl=' + encodeURIComponent(makeQRUrlForCoupon(c.id));
    qrImg.src = qrUrl;

    // Botón usar
    btn.addEventListener('click', ()=>{
      state[c.id] = true;
      saveState(state);
      updateCardVisual(card, true);
    });
  });

  // Si la URL tiene fragment, resaltar
  const frag = window.location.hash ? window.location.hash.substring(1) : null;
  if(frag){
    const el = document.getElementById(frag);
    if(el){
      el.classList.add('highlight');
      // scroll suave
      setTimeout(()=> el.scrollIntoView({behavior:'smooth', block:'center'}),120);
    }
  }
}

/* ======= Controles ======= */
document.getElementById('resetBtn').addEventListener('click', ()=>{
  if(confirm('¿Restablecer todos los cupones a "no usado"?')) {
    state = {};
    saveState(state);
    render();
  }
});

document.getElementById('printBtn').addEventListener('click', ()=>{
  // abrir diálogo de impresión (user puede guardar como PDF)
  window.print();
});

document.getElementById('exportBtn').addEventListener('click', ()=>{
  const dataStr = JSON.stringify(state, null, 2);
  const blob = new Blob([dataStr], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download='registro_cupones_alisson.json'; a.click();
  URL.revokeObjectURL(url);
});

document.getElementById('importBtn').addEventListener('click', ()=>{
  const input = document.createElement('input');
  input.type='file'; input.accept='application/json';
  input.onchange = (e)=>{
    const f = e.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = (ev)=>{
      try{
        const parsed = JSON.parse(ev.target.result);
        state = parsed || {};
        saveState(state);
        render();
        alert('Registro importado correctamente.');
      }catch(err){
        alert('Archivo inválido.');
      }
    };
    reader.readAsText(f);
  };
  input.click();
});

/* ======= Inicialización ======= */
render();

/* Al cargar, si la URL tiene fragment (ej. #c3), lo dejamos destacado */
</script>
</body>
</html>